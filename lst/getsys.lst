     1 			;;; GETSYS PROGRAM - READ TRACKS 0 AND 1 TO MEMORY AT 2880H
     2 			;;; REGISTER                 USE
     3 			;;;    A             (SCRATCH REGISTER)
     4 			;;;    B             TRACK COUNT (0, 1)
     5 			;;;    C             SECTOR COUNT (1,2,...,26)
     6 			;;;    DE            (SCRATCH REGISTER PAIR)
     7 			;;;    HL            LOAD ADDRESS
     8 			;;;    SP            SET TO STACKJ ADDRESS
     9 			;;;
    10 0000 31 80 28	START:  LXI     SP,2880H        ;SET STACK POINTER TO SCRATCH AREA
    11 0003 21 80 28	        LXI     H, 2880H        ;SET BASE LOAD ADDRESS
    12 0006 06 00	        MVI     B, 0            ;START WITH TRACK 0
    13 			RDTRK:                          ;READ NEXT TRACK (INITIALLY 0)
    14 0008 0E 01	        MVI     C, 1            ;START READING WITH SECTOR 1
    15 			RDSEC:                          ;READ NEXT SECTOR
    16 000A CD 20 00	        CALL    READSEC         ;USER SUPPLIED ROUTINE
    17 000D 11 80 00	        LXI     D,128           ;MOVE LOAD ADDRESS TO NEXT 1/2 PAGE
    18 0010 19		        DAD     D               ;HL = HL + 128
    19 0011 0C		        INR     C               ;SECTOR = SECTOR + 1
    20 0012 79		        MOV     A,C             ;CHECK FOR END OF TRACK
    21 0013 FE 1B	        CPI     27
    22 0015 DA 0A 00	        JC      RDSEC           ;CARRY GENERATED IF SECTOR < 27
    23 			;;;
    24 			;;; ARRIVE HERE AT ENDOF TRACK, MOVE TO NEXT TRACK
    25 0018 04		        INR     B
    26 0019 78		        MOV     A,B             ;TEST FOR LAST TRACK
    27 001A FE 02	        CPI     2
    28 001C DA 08 00	        JC      RDTRK           ;CARRY GENERATED IF TRACK < 2
    29 			;;;
    30 			;;; ARRIVE HERE AT END OF LOAD, HALT FOR NOW
    31 001F 76		        HLT
    32 			;;;
    33 			;;; USER-SUPPLIED SUBROUTINE TO READ THE DISK
    34 			READSEC:
    35 			;;; ENTER WITH TRACK NUMBER IN REGISTER B,
    36 			;;;       SECTOR NUMBER IN REGISTER C, AND
    37 			;;;       ADDRESS TO FILL IN HL
    38 			;;; 
    39 0020 C5		        PUSH    B               ;SAVE B AND C REGISTERS
    40 0021 E5		        PUSH    H               ;SAVE HL REGISTERS
    41 			;;;
    42 			;;; Perform disk read at thsi point, branch to
    43 			;;; label START if an error occurs
    44 			;;;
    45 0022 E1		        POP     H               ;RECOVER HL
    46 0023 C1		        POP     B               ;RECOVER B AND C REGISTERS
    47 0024 C9		        RET                     ;BACK TO MAIN PROGRAM
    48
    49     		        END     START


*******************************************************************************
                                 Symbols table
*******************************************************************************

Names		Types	Values
-----		-----	------
START		Label	00000h
RDTRK		Label	00008h
RDSEC		Label	0000Ah
READSEC		Label	00020h

Statistics
----------
"Name"	= 0
"EQU"	= 0
"SET"	= 0
Labels	= 4


