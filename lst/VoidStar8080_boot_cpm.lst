     1     			TITLE	'CP/M Cold Start Loader for the (void *)8080 simulated microcomputer'
     2
     3 				;; This cold start loader resides on Track 00 Sector 1, the
     4 				;; first sector of the diskette. It is loaded into memory at
     5 				;; 0080h by the VoidStar8080 boot rom, and brings the CP/M
     6 				;; system into memory at the proper location (see below), then
     7 				;; starts it running.
     8 				;;
     9 				;; This cold start loader presumes that the BDEV controller
    10 				;; has just read this program from Track 00 Sector 01, and
    11 				;; makes use of its Auto-Increment capabilities to simply
    12 				;; continue reading the disk sequentially at the next sector.
    13 				;;
    14 				;; This cold start loader is not used again, unless the BIOS
    15 				;; is overwritten, at which time this loader will again be
    16 				;; read from the disk into memory.
    17 				;;
    18 				;; CP/M 2.2 requires at least 20 KiB of RAM, which places the
    19 				;; top of memory at 5000H. It can be relocated for larger
    20 				;; memory systems, and the customary way is to compute a bias
    21 				;; "b" which is simply how much more memory is available.
    22 				;;
    23 				;; The CP/M image containing the CCP, BDOS, and BIOS starting
    24 				;; in Track 00 Sector 2 expects to reside at 3400h+b. The BIOS
    25 				;; starting in Track 01 Sector 20 will reside at 4A00h+b, and
    26 				;; the loaded image extends up to 4D00h+b. Memory above that
    27 				;; point is left uninitialized by the loader.
    28
    29      00 00		org	0		;base of memory
    30
    31      00 3E	msize	equ	62		;min mem size in kbytes
    32
    33      A8 00	bias	equ	(msize-20)*1024 ;offset from 20k system
    34
    35      DC 00	text	equ	3400h+bias	;base of the ccp
    36      F2 00	start	equ	4A00h+bias	;base of the bios
    37      F5 00	etext	equ	4D00h+bias	;end of the bios
    38      19 00	bytes	equ	etext-text	;size of cp/m image to load, in bytes
    39
    40      00 0E	bddat	equ	14		;disk controller data port
    41
    42      00 80		org	0080h		;ROM loads us here
    43 0080 11 00 19	cold	lxi     de,bytes
    44 0083 DB 0E	loop	in	bddat           ;get byte from disk
    45 0085 77			mov	m,a             ;put byte to memory
    46 0086 23			inx	hl
    47 0087 1D			dcr	e
    48 0088 C2 83 00		jnz	loop
    49 008B 15			dcr	d
    50 008C C2 83 00		jnz	loop
    51 008F C3 00 F2		jmp	start           ;turn control over to CP/M BIOS
    52
    53     			end


*******************************************************************************
                                 Symbols table
*******************************************************************************

Names		Types	Values
-----		-----	------
msize		EQU	0003Eh
bias		EQU	0A800h
text		EQU	0DC00h
start		EQU	0F200h
etext		EQU	0F500h
bytes		EQU	01900h
bddat		EQU	0000Eh
cold		Label	00080h
loop		Label	00083h

Statistics
----------
"Name"	= 0
"EQU"	= 7
"SET"	= 0
Labels	= 2


